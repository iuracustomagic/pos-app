const _0x3f0e21=_0x5828;function _0x1cd3(){const e=["tegories p","FiriC","toFixed","popularity","_id","tegories.j","some","ZGjDh","ction","Couldn't u","psettings.","../logger","inter","cQucm","fullPrice","le adding ","printRecie","Lost conne","returned","456892ROkLTo","WkuGD","2691315RxhOkt","zmuRP","../display","updateOne","ction with","sendTransa","weight","pdate a ca","s not conn","terminal","The fiscal","exports","message","query","l/index","closeRecie","../schema/","An error o","cks","printFreeT","category","model","son","forEach","body","stringify","/index","ected","barcode","length","n complete","eWDOx","readFileSy","eciept","xMSCH","Transactio","warn"," printer","AOPel","ext","241920iFGhij"," occured w","status","countedPri","a new tran","l printer","ith fiscal","extra","25508vEYdge","reduce","anFhw"," printing ","map","Error with","price","ync"," the fisca","Some error","cashOut","limit","countedSum","then","GKHgX","saction","getTime","parse","the bank r","/server/ap","writeFile","in the car","writeFileS","../ipc","index","env","check","find","findIndex","endTransac","AORJS","SERVER","tion","../fiscal/","create","LmLWq","mode","info","gYslA","json","Terminal E","uCOaT","send","count","722418HzCjFJ","name","ully","deleteOne","checkConne","/server/ca","page","tLTmi"," products ","../api/che","rseOW","001","connectedD","catch","IS_DEV","date","4CXuWwE","data","qty","utf-8","rror: ","Please add","baoik","evices","BGrGB","YWQBr","skip","790715boCgZH","d successf","opularity","sum","BwKMm","items","../termina","100140bWSHWx","BSOMG"," fiscal pr","296NFxhJX","ccured whi","GGCae"," printer i"];return(_0x1cd3=function(){return e})()}!function(){for(var e=_0x5828,r=_0x1cd3();;)try{if(175223==-parseInt(e(480))+parseInt(e(438))/2+parseInt(e(412))/3+-parseInt(e(548))/4*(parseInt(e(405))/5)+-parseInt(e(532))/6+-parseInt(e(488))/7*(-parseInt(e(415))/8)+parseInt(e(440))/9)break;r.push(r.shift())}catch(e){r.push(r.shift())}}();const fs=require("fs"),logger=require(_0x3f0e21(430)),{product,transaction}=require(_0x3f0e21(456)+_0x3f0e21(512)),terminal=require(_0x3f0e21(411)+_0x3f0e21(454)),fisc=require(_0x3f0e21(521)+_0x3f0e21(512)),disp=require(_0x3f0e21(442)+_0x3f0e21(466)),refresh=(process?.[_0x3f0e21(513)]?.[_0x3f0e21(519)]?{}:require(_0x3f0e21(511)))["refresh"],{uploadChecks,uploadReturned}=require(_0x3f0e21(541)+_0x3f0e21(458));async function newPayment(a,s){const o=_0x3f0e21,u={zmuRP:function(e,r){return r<=e},BGrGB:o(428)+o(447)+o(419)+o(407),BSOMG:o(475)+o(470)+o(406)+o(534),xMSCH:function(e,r){return e(r)},YWQBr:o(543),AORJS:o(551),GGCae:function(e,r){return e===r},cQucm:function(e,r){return e&&r},ZGjDh:function(e){return e()},anFhw:o(493)+o(414)+o(431),LmLWq:o(493)+o(491)+o(506)+o(473),baoik:o(436)+o(444)+o(496)+o(485),rseOW:o(497)+o(481)+o(486)+o(477),uCOaT:o(450)+o(418)+o(448)+o(467),AOPel:o(553)+o(540)+o(509)+"t!",eWDOx:o(457)+o(416)+o(434)+o(484)+o(503)},r=JSON[o(505)](fs[o(472)+"nc"](process[o(513)][o(487)]+(o(507)+o(429)+o(527))))[o(544)+o(555)],{fiscal:i,display:t,z:f}=r;try{if(!a[o(464)][o(549)][o(410)][o(469)])throw new Error(u[o(478)]);const d=async()=>{const n=o,c={BwKMm:u[n(556)]},e=await transaction[n(522)](a[n(464)][n(549)]),i=(s[n(530)](u[n(413)]),process[n(513)][n(546)]||await u[n(474)](uploadChecks,{checks:[{...a[n(464)][n(549)],items:a[n(464)][n(549)][n(410)][n(492)](e=>({_id:e[n(423)],countedPrice:e[n(483)+"ce"],fullPrice:e[n(433)],qty:e[n(550)],price:e[n(494)]})),_id:e[n(423)],date:e[n(547)],shop:u[n(557)],cass:u[n(557)]}]}),JSON[n(505)](fs[n(472)+"nc"](process[n(513)][n(487)]+(n(537)+n(424)+n(462)),u[n(518)])));if(t&&disp[t[n(461)]][n(517)+n(520)](),u[n(417)](f,!0))try{fs[n(510)+n(495)](process[n(513)][n(487)]+(n(507)+n(429)+n(527)),JSON[n(465)]({...r,z:new Date},null,2))}catch{}a[n(464)][n(549)][n(410)][n(463)](async r=>{const t=n;var e;r[t(550)]&&(e=i[t(516)](e=>e[t(533)]===r[t(460)]),await product[t(443)]({_id:r[t(423)],"addition.barcode":r[t(468)]},{$inc:{"addition.$.popularity":r[t(550)]}}),u[t(441)](e,0))&&(i[e][t(422)]+=r[t(446)]?1:r[t(550)]),fs[t(508)](process[t(513)][t(487)]+(t(537)+t(424)+t(462)),JSON[t(465)](i),e=>{var r=t;e&&logger[r(476)](c[r(409)])})})};if(process[o(513)][o(546)])return a[o(464)][o(549)][o(524)][o(425)](e=>1===e[o(524)])?void terminal[a[o(464)][o(549)][o(449)]][o(445)+o(427)](a[o(464)][o(549)][o(524)][o(515)](e=>1===e[o(524)])[o(408)])[o(501)](d)[o(545)](e=>{var r=o;s[r(482)](500)[r(530)](r(528)+r(552)+(e[r(452)]||e||""))}):void u[o(426)](d);a[o(464)][o(549)][o(524)][o(425)](e=>1===e[o(524)])?fisc[i[o(461)]][o(536)+o(427)]()[o(501)](()=>{const c=o;terminal[a[c(464)][c(549)][c(449)]][c(445)+c(427)](a[c(464)][c(549)][c(524)][c(515)](e=>1===e[c(524)])[c(408)])[c(501)](async e=>{var r=c,t=await fisc[i[r(461)]][r(435)+"pt"](a[r(464)][r(549)][r(410)],a[r(464)][r(549)][r(524)]),n=await fisc[i[r(461)]][r(459)+r(479)](e),e=await fisc[i[r(461)]][r(459)+r(479)](e);u[r(432)](n,e)&&t||process?.[r(513)]?.[r(546)]?u[r(426)](d):s[r(482)](500)[r(530)](t?u[r(523)]:u[r(490)])})[c(545)](e=>{var r=c;s[r(482)](500)[r(530)](r(528)+r(552)+e)})})[o(545)](()=>{var e=o;s[e(482)](500)[e(530)](u[e(554)]),refresh&&u[e(426)](refresh)}):fisc[i[o(461)]][o(536)+o(427)]()[o(501)](async()=>{const r=o,t={GKHgX:u[r(542)]},e=await fisc[i[r(461)]][r(435)+"pt"](a[r(464)][r(549)][r(410)],a[r(464)][r(549)][r(524)]);e||process?.[r(513)]?.[r(519)]?u[r(426)](d):fisc[i[r(461)]][r(455)+"pt"]()[r(501)](()=>{var e=r;s[e(482)](500)[e(530)](t[e(502)])})})[o(545)](e=>{var r=o;t&&disp[t[r(461)]][r(517)+r(520)](),s[r(482)](500)[r(530)](e[r(452)]||u[r(529)]),u[r(426)](refresh)})}catch(e){logger[o(525)](e[o(452)]),t&&disp[t[o(461)]][o(517)+o(520)](),s[o(482)](500)[o(530)](e[o(452)]||u[o(471)])}}async function getTransactions(e,r){var t=_0x3f0e21,n={gYslA:function(e,r){return e+r},WkuGD:function(e,r){return e*r},FiriC:function(e,r){return e-r}};try{var c=e[t(453)][t(514)][t(469)]?{date:{$lt:new Date(n[t(526)](new Date(e[t(453)][t(514)])[t(504)](),n[t(439)](60,1e3))),$gte:new Date(n[t(420)](new Date(e[t(453)][t(514)])[t(504)](),n[t(439)](60,1e3)))}}:{},i=await transaction[t(515)](c)[t(404)](+e[t(453)][t(538)])[t(499)](1);r[t(530)]({total:await transaction[t(515)](c)[t(531)](),transaction:i})}catch(e){r[t(482)](500)[t(530)](e[t(452)])}}function _0x5828(e,r){const t=_0x1cd3();return(_0x5828=function(e,r){return e-=404,t[e]})(e,r)}async function returnProduct(r,n){const c=_0x3f0e21,i={tLTmi:function(e,r){return e(r)}};try{var e=JSON[c(505)](fs[c(472)+"nc"](process[c(513)][c(487)]+(c(507)+c(429)+c(527))))[c(544)+c(555)]["fiscal"];fisc[e[c(461)]][c(536)+c(427)]()[c(501)](()=>{const t=c,e=r[t(464)][t(410)][t(489)]((e,r)=>r[t(437)]?+(r[t(500)]+e)[t(421)](2):e,0);fisc[t(498)](e)[t(501)](async()=>{var e=t;await transaction[e(535)]({_id:r[e(464)][e(423)]}),n[e(530)](!0),i[e(539)](uploadReturned,{checks:[{_id:r[e(464)][e(423)],return:r[e(464)][e(410)]}]})})})[c(545)](e=>{var r=c;n[r(482)](500)[r(530)](e[r(452)])})}catch(e){n[c(482)](500)[c(530)](e[c(452)])}}module[_0x3f0e21(451)]={newPayment:newPayment,getTransactions:getTransactions,returnProduct:returnProduct};